# -*- coding: utf-8 -*-
"""
Created on Tue Nov 10 17:30:44 2015

@author: Aaron Foss
"""


#grabs all distinct zipcodes for repair
def get_zips(db):    
    result = db.denver_boulder.distinct("address.postcode")
    return result

#function to identify and strip Colorado zipcodes [80xxx-xxxx] or [80xxx] from addresses
def id_zipcode(name):
    import re
    postalcode = ''        
    m = re.search(r'(80[0-9]{3}|_)\-([0-9]{4}|_)$|(80[0-9]{3}|_)$',name)
    if m:
        pattern = m.group()        
        name = re.sub(pattern,'',name)
        postalcode = m.group()
    else:
        pass
    return name, postalcode

#rebuilds a name string from a name list
def reassemble_name(name):
    if len(name) == 0:
        new = ''
    else:
        new = name[0]
        if len(name)>1:    
            for i in range(1,len(name)):
                new = new +' '+name[i]
    return new    

#audits and repairs zip codes, keeps 9 digit zips when available and makes a 'type' 
#list of unresolvable zip codes
def audit_zips(zip_list):
    import re
    import collections
    zip_types = collections.defaultdict(set)
    zip_names = {}
    for zips in zip_list:
        if zips is not '' and len(zips)>3:        
            _, original_zips = id_zipcode(zips)
            
            original_zips = original_zips.split('-')
            
            if original_zips[0] not in colorado_zips.keys() and original_zips[0] != '':
                zip_types[int(original_zips[0])].add(int(original_zips[0]))
            elif original_zips[0] != '':    
                new = reassemble_name(original_zips)
                new = re.sub(' ','-',new.strip())
                zip_names[zips] = {}
                zip_names[zips]['postcode'] = new 
                zip_names[zips]['city'] = colorado_zips[original_zips[0]]
            
        
    return zip_types, zip_names

#function to update zipcodes
def update_zips_db(data, db):
    for entry in data:
        db.denver_boulder.update_many({'address.postcode' : entry},{'$set': {'address.postcode': data[entry]['postcode'],'address.city': data[entry]['city']}})
        pass

#long dictionary of Colorado zipcodes and cities for validation
colorado_zips = {    
            '80254':'Denver',
            '80023':'Broomfield',
            '80001':'Arvada',
            '80002':'Arvada',
            '80003':'Arvada',
            '80004':'Arvada',
            '80005':'Arvada',
            '80006':'Arvada',
            '80007':'Arvada',
            '80010':'Aurora',
            '80011':'Aurora',
            '80012':'Aurora',
            '80013':'Aurora',
            '80014':'Aurora',
            '80015':'Aurora',
            '80016':'Aurora',
            '80017':'Aurora',
            '80018':'Aurora',
            '80019':'Aurora',
            '80020':'Broomfield',
            '80021':'Broomfield',
            '80022':'Commerce City',
            '80024':'Dupont',
            '80025':'Eldorado Springs',
            '80026':'Lafayette',
            '80027':'Louisville',
            '80028':'Louisville',
            '80030':'Westminster',
            '80031':'Westminster',
            '80033':'Wheat Ridge',
            '80034':'Wheat Ridge',
            '80035':'Westminster',
            '80036':'Westminster',
            '80037':'Commerce City',
            '80038':'Broomfield',
            '80040':'Aurora',
            '80041':'Aurora',
            '80042':'Aurora',
            '80044':'Aurora',
            '80045':'Aurora',
            '80046':'Aurora',
            '80047':'Aurora',
            '80101':'Agate',
            '80102':'Bennett',
            '80103':'Byers',
            '80104':'Castle Rock',
            '80105':'Deer Trail',
            '80106':'Elbert',
            '80107':'Elizabeth',
            '80108':'Castle Rock',
            '80109':'Castle Rock',
            '80110':'Englewood',
            '80111':'Englewood',
            '80112':'Englewood',
            '80113':'Englewood',
            '80116':'Franktown',
            '80117':'Kiowa',
            '80118':'Larkspur',
            '80120':'Littleton',
            '80121':'Littleton',
            '80122':'Littleton',
            '80123':'Littleton',
            '80124':'Littleton',
            '80125':'Littleton',
            '80126':'Littleton',
            '80127':'Littleton',
            '80128':'Littleton',
            '80129':'Littleton',
            '80130':'Littleton',
            '80131':'Louviers',
            '80132':'Monument',
            '80133':'Palmer Lake',
            '80134':'Parker',
            '80135':'Sedalia',
            '80136':'Strasburg',
            '80137':'Watkins',
            '80138':'Parker',
            '80150':'Englewood',
            '80151':'Englewood',
            '80155':'Englewood',
            '80160':'Littleton',
            '80161':'Littleton',
            '80162':'Littleton',
            '80163':'Littleton',
            '80165':'Littleton',
            '80166':'Littleton',
            '80201':'Denver',
            '80202':'Denver',
            '80203':'Denver',
            '80204':'Denver',
            '80205':'Denver',
            '80206':'Denver',
            '80207':'Denver',
            '80208':'Denver',
            '80209':'Denver',
            '80210':'Denver',
            '80211':'Denver',
            '80212':'Denver',
            '80214':'Denver',
            '80215':'Denver',
            '80216':'Denver',
            '80217':'Denver',
            '80218':'Denver',
            '80219':'Denver',
            '80220':'Denver',
            '80221':'Denver',
            '80222':'Denver',
            '80223':'Denver',
            '80224':'Denver',
            '80225':'Denver',
            '80226':'Denver',
            '80227':'Denver',
            '80228':'Denver',
            '80229':'Denver',
            '80230':'Denver',
            '80231':'Denver',
            '80232':'Denver',
            '80233':'Denver',
            '80234':'Denver',
            '80235':'Denver',
            '80236':'Denver',
            '80237':'Denver',
            '80238':'Denver',
            '80239':'Denver',
            '80241':'Denver',
            '80243':'Denver',
            '80244':'Denver',
            '80246':'Denver',
            '80247':'Denver',
            '80248':'Denver',
            '80249':'Denver',
            '80250':'Denver',
            '80251':'Denver',
            '80252':'Denver',
            '80256':'Denver',
            '80257':'Denver',
            '80259':'Denver',
            '80260':'Denver',
            '80261':'Denver',
            '80262':'Denver',
            '80263':'Denver',
            '80264':'Denver',
            '80265':'Denver',
            '80266':'Denver',
            '80271':'Denver',
            '80273':'Denver',
            '80274':'Denver',
            '80279':'Denver',
            '80280':'Denver',
            '80281':'Denver',
            '80290':'Denver',
            '80291':'Denver',
            '80293':'Denver',
            '80294':'Denver',
            '80295':'Denver',
            '80299':'Denver',
            '80301':'Boulder',
            '80302':'Boulder',
            '80303':'Boulder',
            '80304':'Boulder',
            '80305':'Boulder',
            '80306':'Boulder',
            '80307':'Boulder',
            '80308':'Boulder',
            '80309':'Boulder',
            '80310':'Boulder',
            '80314':'Boulder',
            '80321':'Boulder',
            '80322':'Boulder',
            '80323':'Boulder',
            '80328':'Boulder',
            '80329':'Boulder',
            '80401':'Golden',
            '80402':'Golden',
            '80403':'Golden',
            '80419':'Golden',
            '80420':'Alma',
            '80421':'Bailey',
            '80422':'Black Hawk',
            '80423':'Bond',
            '80424':'Breckenridge',
            '80425':'Buffalo Creek',
            '80426':'Burns',
            '80427':'Central City',
            '80428':'Clark',
            '80429':'Climax',
            '80430':'Coalmont',
            '80432':'Como',
            '80433':'Conifer',
            '80434':'Cowdrey',
            '80435':'Dillon',
            '80436':'Dumont',
            '80437':'Evergreen',
            '80438':'Empire',
            '80439':'Evergreen',
            '80440':'Fairplay',
            '80442':'Fraser',
            '80443':'Frisco',
            '80444':'Georgetown',
            '80446':'Granby',
            '80447':'Grand Lake',
            '80448':'Grant',
            '80449':'Hartsel',
            '80451':'Hot Sulphur Springs',
            '80452':'Idaho Springs',
            '80453':'Idledale',
            '80454':'Indian Hills',
            '80455':'Jamestown',
            '80456':'Jefferson',
            '80457':'Kittredge',
            '80459':'Kremmling',
            '80461':'Leadville',
            '80463':'Mc Coy',
            '80465':'Morrison',
            '80466':'Nederland',
            '80467':'Oak Creek',
            '80468':'Parshall',
            '80469':'Phippsburg',
            '80470':'Pine',
            '80471':'Pinecliffe',
            '80473':'Rand',
            '80474':'Rollinsville',
            '80475':'Shawnee',
            '80476':'Silver Plume',
            '80477':'Steamboat Springs',
            '80478':'Tabernash',
            '80479':'Toponas',
            '80480':'Walden',
            '80481':'Ward',
            '80482':'Winter Park',
            '80483':'Yampa',
            '80487':'Steamboat Springs',
            '80488':'Steamboat Springs',
            '80497':'Silverthorne',
            '80498':'Silverthorne',
            '80501':'Longmont',
            '80502':'Longmont',
            '80503':'Longmont',
            '80504':'Longmont',
            '80510':'Allenspark',
            '80511':'Estes Park',
            '80512':'Bellvue',
            '80513':'Berthoud',
            '80514':'Dacono',
            '80515':'Drake',
            '80516':'Erie',
            '80517':'Estes Park',
            '80520':'Firestone',
            '80521':'Fort Collins',
            '80522':'Fort Collins',
            '80523':'Fort Collins',
            '80524':'Fort Collins',
            '80525':'Fort Collins',
            '80526':'Fort Collins',
            '80527':'Fort Collins',
            '80528':'Fort Collins',
            '80530':'Frederick',
            '80532':'Glen Haven',
            '80533':'Hygiene',
            '80534':'Johnstown',
            '80535':'Laporte',
            '80536':'Livermore',
            '80537':'Loveland',
            '80538':'Loveland',
            '80539':'Loveland',
            '80540':'Lyons',
            '80541':'Masonville',
            '80542':'Mead',
            '80543':'Milliken',
            '80544':'Niwot',
            '80545':'Red Feather Lakes',
            '80546':'Severance',
            '80547':'Timnath',
            '80549':'Wellington',
            '80550':'Windsor',
            '80551':'Windsor',
            '80553':'Fort Collins',
            '80601':'Brighton',
            '80602':'Brighton',
            '80603':'Brighton',
            '80610':'Ault',
            '80611':'Briggsdale',
            '80612':'Carr',
            '80614':'Eastlake',
            '80615':'Eaton',
            '80620':'Evans',
            '80621':'Fort Lupton',
            '80622':'Galeton',
            '80623':'Gilcrest',
            '80624':'Gill',
            '80631':'Greeley',
            '80632':'Greeley',
            '80633':'Greeley',
            '80634':'Greeley',
            '80638':'Greeley',
            '80639':'Greeley',
            '80640':'Henderson',
            '80642':'Hudson',
            '80643':'Keenesburg',
            '80644':'Kersey',
            '80645':'La Salle',
            '80646':'Lucerne',
            '80648':'Nunn',
            '80649':'Orchard',
            '80650':'Pierce',
            '80651':'Platteville',
            '80652':'Roggen',
            '80653':'Weldona',
            '80654':'Wiggins',
            '80701':'Fort Morgan',
            '80705':'Log Lane Village',
            '80720':'Akron',
            '80721':'Amherst',
            '80722':'Atwood',
            '80723':'Brush',
            '80726':'Crook',
            '80727':'Eckley',
            '80728':'Fleming',
            '80729':'Grover',
            '80731':'Haxtun',
            '80732':'Hereford',
            '80733':'Hillrose',
            '80734':'Holyoke',
            '80735':'Idalia',
            '80736':'Iliff',
            '80737':'Julesburg',
            '80740':'Lindon',
            '80741':'Merino',
            '80742':'New Raymer',
            '80743':'Otis',
            '80744':'Ovid',
            '80745':'Padroni',
            '80746':'Paoli',
            '80747':'Peetz',
            '80749':'Sedgwick',
            '80750':'Snyder',
            '80751':'Sterling',
            '80754':'Stoneham',
            '80755':'Vernon',
            '80757':'Woodrow',
            '80758':'Wray',
            '80759':'Yuma',
            '80801':'Anton',
            '80802':'Arapahoe',
            '80804':'Arriba',
            '80805':'Bethune',
            '80807':'Burlington',
            '80808':'Calhan',
            '80809':'Cascade',
            '80810':'Cheyenne Wells',
            '80812':'Cope',
            '80813':'Cripple Creek',
            '80814':'Divide',
            '80815':'Flagler',
            '80816':'Florissant',
            '80817':'Fountain',
            '80818':'Genoa',
            '80819':'Green Mountain Falls',
            '80820':'Guffey',
            '80821':'Hugo',
            '80822':'Joes',
            '80823':'Karval',
            '80824':'Kirk',
            '80825':'Kit Carson',
            '80826':'Limon',
            '80827':'Lake George',
            '80828':'Limon',
            '80829':'Manitou Springs',
            '80830':'Matheson',
            '80831':'Peyton',
            '80832':'Ramah',
            '80833':'Rush',
            '80834':'Seibert',
            '80835':'Simla',
            '80836':'Stratton',
            '80840':'U S A F Academy',
            '80841':'U S A F Academy',
            '80860':'Victor',
            '80861':'Vona',
            '80862':'Wild Horse',
            '80863':'Woodland Park',
            '80864':'Yoder',
            '80866':'Woodland Park',
            '80901':'Colorado Springs',
            '80903':'Colorado Springs',
            '80904':'Colorado Springs',
            '80905':'Colorado Springs',
            '80906':'Colorado Springs',
            '80907':'Colorado Springs',
            '80908':'Colorado Springs',
            '80909':'Colorado Springs',
            '80910':'Colorado Springs',
            '80911':'Colorado Springs',
            '80912':'Colorado Springs',
            '80913':'Colorado Springs',
            '80914':'Colorado Springs',
            '80915':'Colorado Springs',
            '80916':'Colorado Springs',
            '80917':'Colorado Springs',
            '80918':'Colorado Springs',
            '80919':'Colorado Springs',
            '80920':'Colorado Springs',
            '80921':'Colorado Springs',
            '80922':'Colorado Springs',
            '80923':'Colorado Springs',
            '80924':'Colorado Springs',
            '80925':'Colorado Springs',
            '80926':'Colorado Springs',
            '80927':'Colorado Springs',
            '80928':'Colorado Springs',
            '80929':'Colorado Springs',
            '80930':'Colorado Springs',
            '80931':'Colorado Springs',
            '80932':'Colorado Springs',
            '80933':'Colorado Springs',
            '80934':'Colorado Springs',
            '80935':'Colorado Springs',
            '80936':'Colorado Springs',
            '80937':'Colorado Springs',
            '80938':'Colorado Springs',
            '80939':'Colorado Springs',
            '80940':'Colorado Springs',
            '80941':'Colorado Springs',
            '80942':'Colorado Springs',
            '80943':'Colorado Springs',
            '80944':'Colorado Springs',
            '80945':'Colorado Springs',
            '80946':'Colorado Springs',
            '80947':'Colorado Springs',
            '80949':'Colorado Springs',
            '80950':'Colorado Springs',
            '80951':'Colorado Springs',
            '80960':'Colorado Springs',
            '80962':'Colorado Springs',
            '80970':'Colorado Springs',
            '80977':'Colorado Springs',
            '80995':'Colorado Springs',
            '80997':'Colorado Springs',
            '81001':'Pueblo',
            '81002':'Pueblo',
            '81003':'Pueblo',
            '81004':'Pueblo',
            '81005':'Pueblo',
            '81006':'Pueblo',
            '81007':'Pueblo',
            '81008':'Pueblo',
            '81009':'Pueblo',
            '81010':'Pueblo',
            '81011':'Pueblo',
            '81012':'Pueblo',
            '81019':'Colorado City',
            '81020':'Aguilar',
            '81021':'Arlington',
            '81022':'Avondale',
            '81023':'Beulah',
            '81024':'Boncarbo',
            '81025':'Boone',
            '81027':'Branson',
            '81029':'Campo',
            '81030':'Cheraw',
            '81033':'Crowley',
            '81034':'Crowley',
            '81036':'Eads',
            '81038':'Fort Lyon',
            '81039':'Fowler',
            '81040':'Gardner',
            '81041':'Granada',
            '81043':'Hartman',
            '81044':'Hasty',
            '81045':'Haswell',
            '81046':'Hoehne',
            '81047':'Holly',
            '81049':'Kim',
            '81050':'La Junta',
            '81052':'Lamar',
            '81054':'Las Animas',
            '81055':'La Veta',
            '81057':'Mc Clave',
            '81058':'Manzanola',
            '81059':'Model',
            '81062':'Olney Springs',
            '81063':'Ordway',
            '81064':'Pritchett',
            '81067':'Rocky Ford',
            '81069':'Rye',
            '81071':'Sheridan Lake',
            '81073':'Springfield',
            '81076':'Sugar City',
            '81077':'Swink',
            '81081':'Trinchera',
            '81082':'Trinidad',
            '81084':'Two Buttes',
            '81087':'Vilas',
            '81089':'Walsenburg',
            '81090':'Walsh',
            '81091':'Weston',
            '81092':'Wiley',
            '81101':'Alamosa',
            '81102':'Alamosa',
            '81120':'Antonito',
            '81121':'Arboles',
            '81122':'Bayfield',
            '81123':'Blanca',
            '81124':'Capulin',
            '81125':'Center',
            '81126':'Chama',
            '81127':'Chimney Rock',
            '81128':'Chromo',
            '81129':'Conejos',
            '81130':'Creede',
            '81131':'Crestone',
            '81132':'Del Norte',
            '81133':'Fort Garland',
            '81134':'Garcia',
            '81135':'Homelake',
            '81136':'Hooper',
            '81137':'Ignacio',
            '81138':'Jaroso',
            '81140':'La Jara',
            '81141':'Manassa',
            '81143':'Moffat',
            '81144':'Monte Vista',
            '81146':'Mosca',
            '81147':'Pagosa Springs',
            '81148':'Romeo',
            '81149':'Saguache',
            '81151':'Sanford',
            '81152':'San Luis',
            '81153':'San Pablo',
            '81154':'South Fork',
            '81155':'Villa Grove',
            '81157':'Pagosa Springs',
            '81201':'Salida',
            '81210':'Almont',
            '81211':'Buena Vista',
            '81212':'Canon City',
            '81215':'Canon City',
            '81220':'Cimarron',
            '81221':'Coal Creek',
            '81222':'Coaldale',
            '81223':'Cotopaxi',
            '81224':'Crested Butte',
            '81225':'Crested Butte',
            '81226':'Florence',
            '81227':'Monarch',
            '81228':'Granite',
            '81230':'Gunnison',
            '81231':'Gunnison',
            '81232':'Hillside',
            '81233':'Howard',
            '81235':'Lake City',
            '81236':'Nathrop',
            '81237':'Ohio City',
            '81239':'Parlin',
            '81240':'Penrose',
            '81241':'Pitkin',
            '81242':'Poncha Springs',
            '81243':'Powderhorn',
            '81244':'Rockvale',
            '81247':'Gunnison',
            '81248':'Sargents',
            '81251':'Twin Lakes',
            '81252':'Westcliffe',
            '81253':'Wetmore',
            '81290':'Florence',
            '81301':'Durango',
            '81302':'Durango',
            '81303':'Durango',
            '81320':'Cahone',
            '81321':'Cortez',
            '81323':'Dolores',
            '81324':'Dove Creek',
            '81325':'Egnar',
            '81326':'Hesperus',
            '81327':'Lewis',
            '81328':'Mancos',
            '81329':'Marvel',
            '81330':'Mesa Verde National Park',
            '81331':'Pleasant View',
            '81332':'Rico',
            '81334':'Towaoc',
            '81335':'Yellow Jacket',
            '81401':'Montrose',
            '81402':'Montrose',
            '81410':'Austin',
            '81411':'Bedrock',
            '81413':'Cedaredge',
            '81414':'Cory',
            '81415':'Crawford',
            '81416':'Delta',
            '81418':'Eckert',
            '81419':'Hotchkiss',
            '81420':'Lazear',
            '81422':'Naturita',
            '81423':'Norwood',
            '81424':'Nucla',
            '81425':'Olathe',
            '81426':'Ophir',
            '81427':'Ouray',
            '81428':'Paonia',
            '81429':'Paradox',
            '81430':'Placerville',
            '81431':'Redvale',
            '81432':'Ridgway',
            '81433':'Silverton',
            '81434':'Somerset',
            '81435':'Telluride',
            '81501':'Grand Junction',
            '81502':'Grand Junction',
            '81503':'Grand Junction',
            '81504':'Grand Junction',
            '81505':'Grand Junction',
            '81506':'Grand Junction',
            '81520':'Clifton',
            '81521':'Fruita',
            '81522':'Gateway',
            '81523':'Glade Park',
            '81524':'Loma',
            '81525':'Mack',
            '81526':'Palisade',
            '81527':'Whitewater',
            '81601':'Glenwood Springs',
            '81602':'Glenwood Springs',
            '81610':'Dinosaur',
            '81611':'Aspen',
            '81612':'Aspen',
            '81615':'Snowmass Village',
            '81620':'Avon',
            '81621':'Basalt',
            '81623':'Carbondale',
            '81624':'Collbran',
            '81625':'Craig',
            '81626':'Craig',
            '81630':'De Beque',
            '81631':'Eagle',
            '81632':'Edwards',
            '81633':'Dinosaur',
            '81635':'Parachute',
            '81636':'Battlement Mesa',
            '81637':'Gypsum',
            '81638':'Hamilton',
            '81639':'Hayden',
            '81640':'Maybell',
            '81641':'Meeker',
            '81642':'Meredith',
            '81643':'Mesa',
            '81645':'Minturn',
            '81646':'Molina',
            '81647':'New Castle',
            '81648':'Rangely',
            '81649':'Red Cliff',
            '81650':'Rifle',
            '81652':'Silt',
            '81653':'Slater',
            '81654':'Snowmass',
            '81655':'Wolcott',
            '81656':'Woody Creek',
            '81657':'Vail',
            '81658':'Vail',
            }